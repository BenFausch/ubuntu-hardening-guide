<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Ubuntu/Apache Hardening guide</title>
    <meta name="description" content="A guide for hardening ubuntu and apache">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            margin: 3em;
            background-color: rgb(17, 0, 47);
            color: whitesmoke;
            font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif
        }
    </style>
</head>

<body>

    <h1 id="ubuntu-1004--apache-server-setup-guide">UBUNTU 10.04 / APACHE SERVER SETUP GUIDE</h1>
    <p>Includes build options for Laravel, WP, etc</p>
    <h2 id="aws---small-serverdevelopment-server">AWS - SMALL SERVER/DEVELOPMENT SERVER</h2>
    <p>In EC2, create a new instance.</p>
    <p>Choose ubuntu 18.04 LTS.</p>
    <p>Size `micro` or `small` suffice for most installations. Production sizes should be `medium` or larger.</p>
    <p>Create and download a new PEM key, title it something that makes contextual sense. Such as:
        `server-key.pem`</p>
    <p>Create a new security group for devs, add your IP address+&#39;/32&#39; in the field, select ssh to allow access
        from your local.
        Also add a rule to allow http port 80 and https port 443</p>
    <p>All other defaults are fine, and can be modified to fit project spec.</p>
    <h3 id="ssh">SSH</h3>
    <p>Use the `connect` button in the EC2 admin screen to get the ssh connection string</p>
    <p>Test out your connection, add your your public key to the `authorized_keys` file in the `.ssh` directory.
        To get your ssh key:
        `cat ~/.ssh/id_rsa.pub`</p>
    <ul>
        <li>Timeouts when connecting to AWS are almost always security group misconfiguration, check that your IP is
            listed in the security group with ssh access port 22, and has a block ID after your IP of /32</li>
    </ul>
    <p>Then remove password login for ssh:
        `sudo nano /etc/ssh/sshd_config`
        Set `ChallengeResponseAuthentication no` in that file</p>
    <p>Then set auto-logout behavior (30-60 min is best)
        `sudo nano /etc/ssh/sshd_config`
        Set the following (timeout is in sec)
        `ClientAliveInterval 1800
        ClientAliveCountMax 0`
        Then restart ssh
        `sudo systemctl restart ssh`</p>
    <h3 id="login-screen">LOGIN SCREEN</h3>
    <p>Add a customized login screen by editing `/etc/motd`</p>
    <p>Use the &#39;Big&#39; ascii text generated on this site:
        <a href="%60%3Chttp://patorjk.com/software/taag/#p=display&f=Big&t=YourSIte%3E%60">ASCII Text Generator</a>
    </p>
    <h3 id="deploymentapp-users">DEPLOYMENT/APP USERS</h3>
    <p>Create a new user with no sudo access and no pw for deployments/git to run within.
        `sudo adduser *USERNAME*`
        `sudo passwd -d *USERNAME*`
        Create an .ssh dir in that user&#39;s home dir
        `sudo mkdir /home/USERNAME/.ssh`
        And add your public key to a new `authorized_keys` file to login as that user (same as above)
        `sudo nano /home/USERNAME/.ssh/authorized_keys`</p>
    <p>Exit and test your connection with the new user, verify that the user cannot sudo.</p>
    <h3 id="git">GIT</h3>
    <p>Ubuntu uses an older version of git. Update it with:
        `sudo add-apt-repository ppa:git-core/ppa`
        `sudo apt-get update`
        `sudo apt-get install git`</p>
    <p>Create a `/var/www/html` dir to host your repository.</p>
    <p>Create a folder for your repo i.e. `*YOURSITE*`</p>
    <p>Modify permissions on that folder to use the deployment user
        `sudo chown -R USERNAME:USERNAME *YOURSITE*`</p>
    <p>Create an empty repo and set the receive behavior to updateInstead:
        `git init`
        `git config receive.denyCurrentBranch updateInstead`</p>
    <p>Add a remote to your local using the new user, make sure perms are all set to that deploy user:
        `git remote add staging <a
            href="mailto:&#x55;&#83;&#x45;&#x52;&#x4e;&#x41;&#x4d;&#x45;&#x40;&#101;&#99;&#x32;&#45;&#49;&#45;&#49;&#49;&#x2d;&#x31;&#49;&#x31;&#45;&#49;&#x31;&#49;&#x2e;&#117;&#x73;&#x2d;&#101;&#97;&#x73;&#x74;&#x2d;&#50;&#46;&#x63;&#111;&#x6d;&#112;&#x75;&#116;&#x65;&#46;&#x61;&#109;&#97;&#122;&#x6f;&#x6e;&#x61;&#119;&#115;&#x2e;&#99;&#x6f;&#109;">&#x55;&#83;&#x45;&#x52;&#x4e;&#x41;&#x4d;&#x45;&#x40;&#101;&#99;&#x32;&#45;&#49;&#45;&#49;&#49;&#x2d;&#x31;&#49;&#x31;&#45;&#49;&#x31;&#49;&#x2e;&#117;&#x73;&#x2d;&#101;&#97;&#x73;&#x74;&#x2d;&#50;&#46;&#x63;&#111;&#x6d;&#112;&#x75;&#116;&#x65;&#46;&#x61;&#109;&#97;&#122;&#x6f;&#x6e;&#x61;&#119;&#115;&#x2e;&#99;&#x6f;&#109;</a>:/var/www/html/staging.*YOURSITE*`
    </p>
    <p>Test out a push to the server:
        `git push staging HEAD:master --force`</p>
    <p>SSH in and verify your files have been updated.</p>
    <h3 id="node">NODE</h3>
    <p><a href="https://www.digitalocean.com/community/tutorials/how-to-install-node-js-on-ubuntu-18-04">Sourced from
            here</a>
        <strong>Using the PPA version</strong>
        `cd ~`
        `curl -sL <a href="https://deb.nodesource.com/setup_10.x">https://deb.nodesource.com/setup_10.x</a> -o
        nodesource_setup.sh`
        `sudo bash nodesource_setup.sh`
        `sudo apt install nodejs`
        `node -v`
    </p>
    <h3 id="npm">NPM</h3>
    <p>The above script installs npm @v6, which is too old. Update it using:
        `sudo npm install npm -g`</p>
    <h3 id="route53">ROUTE53</h3>
    <p>If Route53 is being used, go into the AWS console-&gt;route53 and add a line for a subdomain that points to your
        IP.
        Click on &#39;hosted zones&#39;-&gt;zone you want to modify-&gt;Create Record Set</p>
    <p>Add a record set for the subdomain (staging/test) and the ip of the ec2 instance it&#39;s pointing to</p>
    <h3 id="apache">APACHE</h3>
    <p><a href="https://www.digitalocean.com/community/tutorials/how-to-install-the-apache-web-server-on-ubuntu-18-04">Pulled
            from this guide</a>
        <a href="https://www.howtoforge.com/tutorial/install-laravel-on-ubuntu-for-apache/">And this one</a>
    </p>
    <p>Install apache &amp; php@ latest:
        `sudo add-apt-repository ppa:ondrej/php`
        `sudo apt-get update`
        `
        sudo apt-get install apache2<br>sudo apt-get install libapache2-mod-php<br>sudo apt-get install php<br>sudo
        apt-get install php-xml
        sudo apt-get install php-gd
        sudo apt-get install php7.4-opcache (NOTE:needs v number i.e. php7.4-opcache)
        sudo apt-get install php-mbstring
        sudo apt-get install php7.4-curl
        `</p>
    <p>Allow apache port 80 and 443 in the firewall (if ufw enabled):
        `sudo ufw allow &#39;Apache Full&#39;`</p>
    <p>You can check the ufw status using:
        `sudo ufw status`</p>
    <p>Verify Apache is running after install:
        `sudo systemctl status apache2`</p>
    <p>Create a test `index.html` file in `/var/www/html`</p>
    <p>Go to your ec2 instance&#39;s public IP and verify you see that file.</p>
    <h3 id="apache-pt-2-vhosts">APACHE PT 2, VHOSTS</h3>
    <p>Create a conf file to route traffic to your repo
        `sudo nano /etc/apache2/sites-available/staging.*YOURSITE*.conf`</p>
    <p>Basic conf looks like this for a laravel/vue build:</p>
    <p> `&lt;VirtualHost *:80&gt;
        ServerName staging.YOURSITEURL
        DocumentRoot /var/www/html/staging.<em>YOURSITE</em>/public
        ServerAlias staging.YOURSITEURL
        &lt;Directory /var/www/html/staging.*YOURSITE*/public&gt;
        Options All
        AllowOverride All
        order allow,deny
        allow from all
        </Directory>
        ErrorLog /var/log/apache2/error.log
        RewriteEngine on
        RewriteCond %{SERVER_NAME} =staging.YOURSITEURL
        RewriteRule ^ <a href="https://%%7BSERVER_NAME%7D%%7BREQUEST_URI">https://%{SERVER_NAME}%{REQUEST_URI</a>}
        [END,NE,R=permanent]
        </VirtualHost>
    </p>
    <p>&lt;VirtualHost <em>:443&gt;
            ServerName staging.YOURSITEURL
            DocumentRoot /var/www/html/staging.<em>YOURSITE</em>/public
            ServerAlias staging.YOURSITEURL
            ErrorLog /var/log/apache2/error.log
            Header set Access-Control-Allow-Origin:</em>
        &lt;Directory /var/www/html/staging.*YOURSITE*/public&gt;
        Options All
        AllowOverride All
        order allow,deny
        allow from all
        </Directory>
        </VirtualHost>`</p>
    <p>Enable mod_rewrite/headers/mysql, enable your site, disable the default 000 site, reload apache2
        `a2enmod headers`
        `a2enmod rewrite`
        `sudo a2ensite staging.*YOURSITE*.conf`
        `sudo a2dissite 000-default.conf`
        `sudo apt-get install php7.4-mysql`
        `systemctl restart apache2`</p>
    <p>If route53 and apache are configured correctly, you should be able to hit your new url.
        You can verify DNS using the following tool:
        <a href="https://mxtoolbox.com/DNSLookup.aspx">MX Toolbox</a>
    </p>
    <h3 id="basic-auth-if-needed">BASIC AUTH (if needed)</h3>
    <p>This will help keep out a lot of riff raff during development, just a simple encoded pw stored with apache. Makes
        it so only clients see the site
        Add this to your `<Virtualhost>` port 443 block:</p>
    <p>`&lt;Directory &quot;/var/www/vhosts/YOURSITEURL&quot;&gt;
        AuthType Basic
        AuthName &quot;Restricted Content&quot;
        AuthUserFile /etc/apache2/.htpasswd
        Require valid-user
        AllowOverride All
        </Directory>`</p>
    <p>Then you us htpasswd to create the referenced file:
        `cd /etc/apache2 &amp;&amp; touch .htpasswd`
        `htpasswd -c .htpasswd USERNAME`
        Asks for a password and that&#39;s it! Restart apache to see the changes
        <a href="https://www.hostwinds.com/guide/create-use-htpasswd/">Ref</a>
    </p>
    <h3 id="mysqlrds">MYSQL/RDS</h3>
    <p>Create new RDS mysql instance with recommended &quot;easy&quot; settings in the RDS admin screen
        Use a super secure password and non-standard admin username (devadmin), add to .env file sql connection on
        server</p>
    <p><em>Modify security settings to allow ip connections to port 3306 from the ec2 instance&#39;s PRIVATE ip address
            ONLY. This is changed by going to the RDS screen, and clicking on the name of the security group and
            changing INBOUND SETTINGS</em></p>
    <p>Test out connections using tcp over ssh pipe only, no raw sql connections from random IP&#39;s allowed</p>
    <h2 id="laravel-settings">LARAVEl SETTINGS</h2>
    <h3 id="composerartisannpm">COMPOSER/ARTISAN/NPM</h3>
    <p>Install composer
        `apt-get install composer`</p>
    <p>Install dependent php extensions/mysql
        (composer install will tell you which ones it needs as well)
        `sudo apt-get install php7.4-mysql`
        `sudo apt-get install php7.4-curl`
        `sudo apt-get install php7.4-zip`</p>
    <p>Install npm
        `apt install npm`</p>
    <p>Install Yarn
        Remove cmdtest yarn:
        `sudo apt-get remove cmdinstall cmdtest`
        <a href="https://linuxize.com/post/how-to-install-yarn-on-ubuntu-18-04/">Then use this as a guide</a>
    </p>
    <p>Build using composer &amp; artisan, make sure that perms are correct:
        `composer install &amp;&amp; php artisan optimize`</p>
    <p>These should not be necessary if you run npm/yarn/composer as your user, but are here if needed:
        `cd ../ &amp;&amp; chown -R USERNAME:USERNAME staging.*YOURSITE*`
        `chmod -R 777 storage/logs &amp;&amp; chmod -R 777 storage/framework`</p>
    <p>Create a script next to the parent folder in `var/www/html` that builds and resets perms for server maintenance
    </p>
    <h3 id="testing-the-api-endpointmysql">TESTING THE API ENDPOINT/MYSQL</h3>
    <p>Create a basic route to poc the api in `api.php`:
        `Route::get(&#39;/user&#39;, function (Request $request) {`
        `return &#39;hola!&#39;;`
        `});`</p>
    <p>Create a basic route to poc the sql connection in `api.php`</p>
    <p>`Route::get(&#39;/users&#39;, &#39;UserController@show&#39;);`</p>
    <p>Make sure you have a `show` method that returns a model, like this:
        `public function show(users $users)`
        `{`
        `//`
        `return $users-&gt;get();`
        `}`</p>
    <p>Go to the site, verify you see data. If no data, check with:
        `php artisan tinker`
        `DB::connection()-&gt;getPdo();` or `Db::connection()-&gt;getDatabaseName();`</p>
    <h2 id="wordpress-settings">WORDPRESS SETTINGS</h2>
    <p>Touch and modify your `.private-environment-settings.php` file in the server dir. Use the following convention:
        `&lt;?php
        class ServerEnvironmentSettings {
        const dbName = &#39;DBNAME&#39;;
        const dbUsername = &#39;root&#39;;
        const dbPassword = &#39;&#39;;
        const dbHost = &#39;localhost&#39;;
        }
        `
        <em>you will have to create the db manually through a dump if one has already been created locally</em>
    </p>
    <p>Make sure that the `wp_options` table has the correct url for `siteurl` and `home`.
        Make sure that `wp_options` `permalinks` row is empty</p>
    <p>Create script to set file/folder permissions in the server directory:
        <em>/var/www/html/resetPerms.sh</em>
        `#resets perms to proper WP settings
    </p>
    <h1 id="server-files-are-usernameusername">server files are USERNAME:USERNAME</h1>
    <p>chown -R USERNAME:USERNAME *</p>
    <h1 id="proper-perms">proper perms</h1>
    <p>find . -type f -exec chmod 644 {} +
        find . -type d -exec chmod 755 {} +
        chmod 644 staging.YOURSITE/.htaccess
        chmod 644 prod.YOURSITE/.htaccess</p>
    <h1 id="reset-script-to-x">reset script to +x</h1>
    <p>chmod +x resetPermissions.sh</p>
    <h1 id="chown-uploads-to-www-data-server-user">chown uploads to www-data (server user)</h1>
    <p>chown -R www-data:www-data staging.YOURSITE/wp-content/uploads
        chown -R www-data:www-data prod.YOURSITE/wp-content/uploads`</p>
    <p><em>You may have to empty the `active_plugins` row in `wp_options` or do a pw reset if you get locked out using a
            basic password with wordfence activated</em></p>
    <p>ERROR:`Publishing failed. Error message: The response is not a valid JSON response.`
        This is most likely due to a permalink error, try settting Settings-&gt;Permalinks to `Plain` if using a raw IP,
        or `Post Name` for a real url. See <a
            href="https://passionwp.com/response-is-not-a-valid-json-response-error/">this</a> for more.</p>
    <p>ERROR:`Cannot upload media files`
        Verify that you have the dir `wp-content/uploads`, and that its perms are set to `chmod 755`. Re-run your perm
        script if `uploads` exists</p>
    <h3 id="https">HTTPS</h3>
    <p>Use <a href="https://certbot.eff.org/lets-encrypt/ubuntubionic-apache">certbot</a></p>
    <p>Run the following:
        `sudo apt-get update`
        `sudo apt-get install software-properties-common`
        `sudo add-apt-repository universe`
        `sudo add-apt-repository ppa:certbot/certbot`
        `sudo apt-get update`
        `sudo apt-get install certbot python-certbot-apache`</p>
    <p>To obtain an apache cert:
        `sudo certbot --apache`</p>
    <p>Verify a cron is setup. Look in /etc/cron.* folders. Usually can been seen in this one:
        `EDITOR=nano /etc/cron.d`</p>
    <p>Test renewal:
        `sudo certbot renew --dry-run`</p>
    <h3 id="non-www-redirect-to-www-and-http-to-https-example">non-www redirect to www and http to https example:</h3>
    <p>&lt;VirtualHost *:80&gt;
        ServerName <a href="http://www.YOURSITE.org">www.YOURSITE.org</a>
        DocumentRoot /var/www/html/prod.YOURSITE
        ServerAlias YOURSITE.org</p>
    <pre><code>&lt;Directory /var/www/html/prod.YOURSITE&gt;
    Options All -Indexes
    AllowOverride All
    order allow,deny
    allow from all
&lt;/Directory&gt;
ErrorLog /var/log/apache2/error.log
RewriteEngine on
Redirect permanent / https://www.YOURSITE.org
</code></pre>
    <p>SSLCertificateFile /etc/letsencrypt/live/<a
            href="http://www.YOURSITE.org/fullchain.pem">www.YOURSITE.org/fullchain.pem</a>
        SSLCertificateKeyFile /etc/letsencrypt/live/<a
            href="http://www.YOURSITE.org/privkey.pem">www.YOURSITE.org/privkey.pem</a>
        </VirtualHost>
    </p>
    <p>&lt;VirtualHost *:443&gt;
        ServerName <a href="http://www.YOURSITE.org">www.YOURSITE.org</a>
        DocumentRoot /var/www/html/prod.YOURSITE
        ServerAlias YOURSITE.org
        ErrorLog /var/log/apache2/error.log</p>
    <h1 id="header-set-access-control-allow-origin">Header set Access-Control-Allow-Origin:*</h1>
    <pre><code>&lt;Directory /var/www/html/prod.YOURSITE&gt;
    Options All -Indexes
    AllowOverride All
    order allow,deny
    allow from all
&lt;/Directory&gt;
</code></pre>
    <p>RewriteEngine on
        RewriteCond %{HTTP_HOST} !^www. [NC]
        RewriteRule ^(.*)$ <a
            href="https://www.%%7BHTTP_HOST%7D%%7BREQUEST_URI">https://www.%{HTTP_HOST}%{REQUEST_URI</a>} [R=301,L]</p>
    <p>Include /etc/letsencrypt/options-ssl-apache.conf
        SSLCertificateFile /etc/letsencrypt/live/YOURSITE.org/fullchain.pem
        SSLCertificateKeyFile /etc/letsencrypt/live/YOURSITE.org/privkey.pem
        </VirtualHost>
    </p>
    <h3 id="imgmagick">IMGMAGICK</h3>
    <p><a href="https://tecadmin.net/install-imagemagick-on-linux/">Ref</a></p>
    <p>`sudo apt install php php-common gcc`
        `sudo apt install imagemagick`
        `sudo apt install php-imagick`
        `sudo systemctl restart apache2`</p>
    <p>Test if installed:
        `php -m | grep imagick`</p>
    <h3 id="s3">S3</h3>
    <p><a href="https://blog.larapulse.com/laravel/aws-s3-with-laravel-5">Ref</a></p>
    <p>Go to s3 in aws, create a new bucket, turn off &quot;restrict public access&quot;.</p>
    <p>For more security:</p>
    <p>Go to IAM and click &#39;create new policy&#39;, click the &#39;JSON&#39; tab
        Add the following:</p>
    <p>`{
        &quot;Version&quot;: &quot;2012-10-17&quot;,
        &quot;Statement&quot;: [
        {
        &quot;Sid&quot;: &quot;VisualEditor0&quot;,
        &quot;Effect&quot;: &quot;Allow&quot;,
        &quot;Action&quot;: [
        &quot;s3:ListBucket&quot;,
        &quot;s3:GetBucketLocation&quot;
        ],
        &quot;Resource&quot;: &quot;arn:aws:s3:::YOURSITE-staging&quot;
        },
        {
        &quot;Sid&quot;: &quot;VisualEditor1&quot;,
        &quot;Effect&quot;: &quot;Allow&quot;,
        &quot;Action&quot;: [
        &quot;s3:PutObject&quot;,
        &quot;s3:GetObject&quot;,
        &quot;s3:DeleteObject&quot;
        ],
        &quot;Resource&quot;: &quot;arn:aws:s3:::YOURSITE-staging/*&quot;
        },
        {
        &quot;Sid&quot;: &quot;VisualEditor2&quot;,
        &quot;Effect&quot;: &quot;Allow&quot;,
        &quot;Action&quot;: &quot;s3:ListAllMyBuckets&quot;,
        &quot;Resource&quot;: &quot;*&quot;
        }
        ]
        }`</p>
    <p>Change `YOURSITE-staging` to whatever your bucket is called</p>
    <p>Go to IAM-&gt;user-&gt;create user
        Put in name, select &#39;attach existing policies directly&#39;, select the policy name you just created (this
        case is `YOURSITE-staging`)</p>
    <p>Download the .csv and put the values in the server&#39;s `.env`</p>
    <p>To test use tinker and see if you can list/create/see files:
        `php artisan tinker`
        `Storage::disk(&#39;s3&#39;)-&gt;files();`
        `Storage::disk(&#39;s3&#39;)-&gt;put(&#39;Hello.txt&#39;,&#39;hola muchacho!&#39;);`
        `Storage::disk(&#39;s3&#39;)-&gt;files();`
        --Should show the file you just created</p>
    <p><em>If you run into issues, verify that the format of .env values is:</em></p>
    <p>FILESYSTEM_DRIVER=s3
        AWS_ACCESS_KEY_ID=asfdb1234
        AWS_SECRET_ACCESS_KEY=asdf1234/12341234
        AWS_DEFAULT_REGION=&quot;us-east-2&quot; (check s3 bucket region on right of page)
        AWS_BUCKET=YOURSITE-staging
        AWS_URL=BUCKETNAME.s3.REGIONNAME.amazonaws.com</p>
    <p>You can also get url,bucket,region by getting a link to an uploaded file ex.:
        `<a
            href="https://YOURSITE-staging.s3.us-east-2.amazonaws.com/profile.gif%5C">https://YOURSITE-staging.s3.us-east-2.amazonaws.com/profile.gif\</a>`
    </p>
    <h3 id="npm-and-permissions">NPM and permissions</h3>
    <p>ALL NPM related tasks should be run as the pipeline user (i.e. devadmin)
        Once npm is installed with `sudo apt install npm`
        Use (as devadmin user):
        `sudo chown -R $(whoami) ~/.npm`
        `sudo chown -R $(whoami) /usr/lib/node_modules`
        Then run `npm install` and whatever build scripts in your build dir as the devadmin user</p>
    <p>You may have to chmod permissions on files to allow devadmin user to create them</p>
    <h3 id="gatsby">GATSBY</h3>
    <p>Projects controlled by gatsby will need it installed with the root user
        `sudo npm install -g gatsby-cli`</p>
    <h3 id="pipeline">PIPELINE</h3>
    <p>For a laravel-vue-spa build that requires the use of `composer install` and `npm run dev`
        Use the following:</p>
    <p>`image: YOURREPO/build-common:latest
        pipelines:
        branches:
        stage:
        - step:
        name: Staging deployment
        deployment: staging
        caches:
        - node
        - composer
        - vendor
        script:
        - git remote add stage $STAGE_REPO_PATH
        - git push stage HEAD:master --force
        - ssh $STAGE_SERVER &#39;cd /var/www/html/ &amp;&amp; ./resetAndBuildStage.sh&#39;
        definitions:
        caches:
        vendor: ./vendor</p>
    <p>`</p>
    <p><em>Where ./resetAndBuildStage.sh is a script in /var/www/html that installs and sets permissions:</em></p>
    <p>`#THIS SCRIPT IS USED WITH BITBUCKET PIPELINES TO BUILD LARAVEL-VUE PROJECTS</p>
    <h1 id="run-as-root-if-you-have-build-errors">RUN AS ROOT IF YOU HAVE BUILD ERRORS</h1>
    <p>cd staging.<em>YOURSITE</em>
        composer dump-autoload &amp;&amp; php artisan optimize
        npm install
        npm run dev
        cd ../
        chown -R USERNAME:USERNAME staging.<em>YOURSITE</em>
        chmod -R 777 staging.<em>YOURSITE</em>/storage/logs
        chmod -R 777 staging.<em>YOURSITE</em>/storage/framework`</p>
    <p>You will also need to configure environment variables for bitbucket, and add the approved list of IP&#39;s from
        bitbucket to your security group:
        <a
            href="https://confluence.atlassian.com/bitbucket/what-are-the-bitbucket-cloud-ip-addresses-i-should-use-to-configure-my-corporate-firewall-343343385.html">Approved
            bitbucket IP&#39;S</a>
    </p>
    <p>As of 2020, they are:
        34.199.54.113/32, 34.232.25.90/32, 34.232.119.183/32, 34.236.25.177/32, 35.171.175.212/32, 52.54.90.98/32,
        52.202.195.162/32, 52.203.14.55/32, 52.204.96.37/32, 34.218.156.209/32, 34.218.168.212/32, 52.41.219.63/32,
        35.155.178.254/32, 35.160.177.10/32, 34.216.18.129/32,52.8.84.222/32, 52.52.234.127/32, 104.192.136.0/21,
        13.52.5.96/28</p>
    <p>You can paste this whole list into the source ip input field, make sure to do this for the following ports:
        22
        80
        7999</p>
    <h3 id="wp-cli">WP CLI</h3>
    <p>Visit <a href="https://wp-cli.org/">here</a> for detailed documentation. Otherwise, setup is simple:
        `
        curl -O <a
            href="https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar">https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar</a>
        php wp-cli.phar --info
        chmod +x wp-cli.phar
        sudo mv wp-cli.phar /usr/local/bin/wp
        wp --info
        `
        `;</p>
    <p>export const snippet2 = `
        APACHE/UBUNTU HARDENING GUIDE EXTRAS:</p>
    <h1 id="end-user-device-eud-security-guidance">End user device (EUD) security guidance</h1>
    <p>From the UK National Cyber Security Centre</p>
    <h2 id="httpswwwncscgovukcollectionend-user-device-securityplatform-specific-guidanceubuntu-18-04-lts"><a
            href="https://www.ncsc.gov.uk/collection/end-user-device-security/platform-specific-guidance/ubuntu-18-04-lts">https://www.ncsc.gov.uk/collection/end-user-device-security/platform-specific-guidance/ubuntu-18-04-lts</a>
    </h2>
    <h3 id="summary-points">Summary points</h3>
    <ul>
        <li>Users should not be allowed to install arbitrary applications on the device. Applications should be
            authorised by an administrator and deployed via a trusted mechanism.</li>
        <li>Most users should have accounts with no administrative privileges. Users that require administrative
            privileges should use a separate unprivileged account for email and web browsing. It is recommended that
            local administrator accounts have a unique strong password per device.</li>
    </ul>
    <p><strong>takeaway</strong></p>
    <ul>
        <li>NON-ADMIN user for everything but initial install/configuration on server</li>
        <li>installs are restricted to npm/git as much as possible</li>
    </ul>
    <h3 id="network-archdevice-provisioning">Network Arch/Device provisioning</h3>
    <ul>
        <li>handled by AWS, not relevant</li>
    </ul>
    <h3 id="authentication-policy">Authentication Policy</h3>
    <ul>
        <li>Your organisation should have a consistent authentication policy which applies to all users and devices
            capable of accessing its data.</li>
    </ul>
    <p><strong>takeaway</strong></p>
    <ul>
        <li>pw is removed for NON-ADMIN user, all authentication is based on ssh keys</li>
    </ul>
    <h3 id="boot-process-hardening">Boot process hardening</h3>
    <ul>
        <li>handled by AWS, not relevant</li>
    </ul>
    <h3 id="updates">Updates</h3>
    <ul>
        <li>This site recommends regular updates, specifically calling out Snap packages, their necessity to be sourced
            from the Ubuntu store, and maintaining regular updates.</li>
    </ul>
    <h3 id="privacyvpn">Privacy/VPN</h3>
    <ul>
        <li>There are crash reporting and ping tools this site recommends turning off. These are largely for end ubuntu
            users rather than server clients</li>
        <li>This service recommends a VPN for end users. The AWS analogue to this is VPC which is in place</li>
    </ul>
    <h3 id="other-notes">Other notes</h3>
    <p><strong>leveraging auditd</strong></p>
    <p>This is a syslogger with logs available at `/var/log/audit/audit.log`, will log any login/modifications from any
        user on the system. This includes pw changes, perm changes, access, etc.</p>
    <p>Install using this command:
        `sudo apt-get install -y auditd`</p>
    <p>Add these lines to `/etc/audit/rules.d/audit.rules`</p>
    <p>```</p>
    <h2 id="first-rule---delete-all">First rule - delete all</h2>
    <p>-D</p>
    <h2 id="increase-the-buffers-to-survive-stress-events">Increase the buffers to survive stress events</h2>
    <h2 id="make-this-bigger-for-busy-systems">Make this bigger for busy systems</h2>
    <p>-b 8192</p>
    <h2 id="this-determine-how-long-to-wait-in-burst-of-events">This determine how long to wait in burst of events</h2>
    <p>--backlog_wait_time 0</p>
    <h2 id="set-failure-mode-to-syslog">Set failure mode to syslog</h2>
    <p>-f 1</p>
    <h2 id="additional-config-logging-user-interactionmodification">additional config logging user
        interaction/modification</h2>
    <h2 id="srchttpssecurityblogoverflowcom201301a-brief-introduction-to-auditd">src<a
            href="https://security.blogoverflow.com/2013/01/a-brief-introduction-to-auditd/">https://security.blogoverflow.com/2013/01/a-brief-introduction-to-auditd/</a>
    </h2>
    <p>-a always,exit -S adjtimex -S settimeofday -S stime -k time-change
        -a always,exit -S clock_settime -k time-change
        -a always,exit -S sethostname -S setdomainname -k system-locale
        -w /etc/group -p wa -k identity
        -w /etc/passwd -p wa -k identity
        -w /etc/shadow -p wa -k identity
        -w /etc/sudoers -p wa -k identity
        -w /var/run/utmp -p wa -k session
        -w /var/log/wtmp -p wa -k session
        -w /var/log/btmp -p wa -k session
        -w /etc/selinux/ -p wa -k MAC-policy
        ```</p>
    <h1 id="list-of-things-for-hardening-ubuntu">List of things for hardening Ubuntu</h1>
    <p><a
            href="https://gist.github.com/lokhman/cc716d2e2d373dd696b2d9264c0287a3">https://gist.github.com/lokhman/cc716d2e2d373dd696b2d9264c0287a3</a>
    </p>
    <h2 id="force-update-automatic-security-updates">Force update, automatic security updates</h2>
    <p>```
        sudo apt-get update
        sudo apt-get upgrade
        sudo apt-get autoremove
        sudo apt-get autoclean
        ```</p>
    <p>Automatic security updates are configured using `unattended-upgrades` which should already be correctly
        configured in `/etc/apt/apt.conf.d/50unattended-upgrades`</p>
    <p>All `--security` lines in the `Allowed-Origins` section should be uncommented, everything else commented out:</p>
    <p>```
        sudo nano /etc/apt/apt.conf.d/50unattended-upgrades
        : Unattended-Upgrade::Allowed-Origins {
        : &quot;${distro_id}:${distro_codename}-security&quot;;
        : // &quot;${distro_id}:${distro_codename}-updates&quot;;
        : // &quot;${distro_id}:${distro_codename}-proposed&quot;;
        : // &quot;${distro_id}:${distro_codename}-backports&quot;;
        : };
        : // Unattended-Upgrade::Mail &quot;<a
            href="mailto:&#109;&#121;&#x5f;&#117;&#x73;&#101;&#x72;&#x40;&#x6d;&#x79;&#x5f;&#x64;&#x6f;&#109;&#x61;&#x69;&#110;&#46;&#99;&#x6f;&#x6d;">&#109;&#121;&#x5f;&#117;&#x73;&#101;&#x72;&#x40;&#x6d;&#x79;&#x5f;&#x64;&#x6f;&#109;&#x61;&#x69;&#110;&#46;&#99;&#x6f;&#x6d;</a>&quot;;
        ```</p>
    <h2 id="disabling-root-user-and-ubuntu-swapping-in-a-hidden-root">Disabling root user and ubuntu, swapping in a
        hidden root</h2>
    <p>Multiple guides suggest completely disabling the root user, or at the very least turning off sudo access for
        root.
        It is always regularly recommended to create a non-standard sudoer.</p>
    <p>Steps:</p>
    <ul>
        <li>ssh in as ubuntu, run `sudo su`</li>
        <li>`adduser USERNAME`</li>
        <li>standard will be cl<strong>where</strong> is the first to letters of the repo</li>
        <li>input a secure pw (to be removed later)</li>
        <li>add them to the sudoers list `usermod -aG sudo username`</li>
        <li>set the user up for ssh access and no sudo pw:<ul>
                <li>`sudo su &amp;&amp; cd /home/USERNAME`</li>
                <li>`sudo passwd -d USERNAME` - remove pw</li>
                <li>`sudo mkdir /home/USERNAME/.ssh &amp;&amp; chmod 600 /home/USERNAME/.ssh`</li>
                <li>`sudo nano /home/USERNAME/.ssh/authorized_keys &amp;&amp; chmod 600
                    /home/USERNAME/.ssh/authorized_keys` -- add your public key here</li>
                <li>make sure all .ssh files/folders are owned by that ssh user</li>
                <li>remove sudo pw from new admin user `USERNAME ALL=NOPASSWD: ALL`, add this to
                    `/etc/sudoers.d/90-cloud-init-users`</li>
                <li>test login via ssh with new user, verify you can do things like `ls -la /root` for root privs</li>
            </ul>
        </li>
        <li>disable root account<ul>
                <li>`sudo passwd -l root`</li>
            </ul>
        </li>
        <li>if necessary, it can be re-enabled with `sudo passwd -u root`</li>
        <li>lastly, archive the ubuntu ssh login by running `sudo mv /home/ubuntu /home/.ubuntu`</li>
    </ul>
    <h2 id="swap">Swap</h2>
    <ul>
        <li>not available</li>
    </ul>
    <h2 id="systctlconf">systctl.conf</h2>
    <ul>
        <li>
            <p>This is a big part of hardening this server, prevents IP spoofing, logs suspicious packets, redirects.
            </p>
        </li>
        <li>
            <p>It also allows security during overflow events, leveraging ExecShield.</p>
        </li>
        <li>
            <p>IP spoof protection means DDOS protection, especially against `syn flood`</p>
        </li>
        <li>
            <p>Lastly, there is kernel panic protection, restarting the server during memory overage</p>
        </li>
        <li>
            <p>Add these lines to `/etc/sysctl.conf`
                ```</p>
        </li>
    </ul>
    <h1 id="ip-spoofing-protection">IP Spoofing protection</h1>
    <p>net.ipv4.conf.default.rp_filter = 1
        net.ipv4.conf.all.rp_filter = 1</p>
    <h1 id="block-syn-attacks">Block SYN attacks</h1>
    <p>net.ipv4.tcp_syncookies = 1</p>
    <h1 id="controls-ip-packet-forwarding">Controls IP packet forwarding</h1>
    <p>net.ipv4.ip_forward = 0</p>
    <h1 id="ignore-icmp-redirects">Ignore ICMP redirects</h1>
    <p>net.ipv4.conf.all.accept_redirects = 0
        net.ipv6.conf.all.accept_redirects = 0
        net.ipv4.conf.default.accept_redirects = 0
        net.ipv6.conf.default.accept_redirects = 0</p>
    <h1 id="ignore-send-redirects">Ignore send redirects</h1>
    <p>net.ipv4.conf.all.send_redirects = 0
        net.ipv4.conf.default.send_redirects = 0</p>
    <h1 id="disable-source-packet-routing">Disable source packet routing</h1>
    <p>net.ipv4.conf.all.accept_source_route = 0
        net.ipv6.conf.all.accept_source_route = 0
        net.ipv4.conf.default.accept_source_route = 0
        net.ipv6.conf.default.accept_source_route = 0</p>
    <h1 id="log-martians">Log Martians</h1>
    <p>net.ipv4.conf.all.log_martians = 1</p>
    <h1 id="block-syn-attacks-1">Block SYN attacks</h1>
    <p>net.ipv4.tcp_max_syn_backlog = 2048
        net.ipv4.tcp_synack_retries = 2
        net.ipv4.tcp_syn_retries = 5</p>
    <h1 id="log-martians-1">Log Martians</h1>
    <p>net.ipv4.icmp_ignore_bogus_error_responses = 1</p>
    <h1 id="ignore-icmp-broadcast-requests">Ignore ICMP broadcast requests</h1>
    <p>net.ipv4.icmp_echo_ignore_broadcasts = 1</p>
    <h1 id="ignore-directed-pings">Ignore Directed pings</h1>
    <p>net.ipv4.icmp_echo_ignore_all = 1
        kernel.exec-shield = 1
        kernel.randomize_va_space = 1</p>
    <h1 id="disable-ipv6-if-required-ipv6-might-caus-issues-with-the-internet-connection-being-slow">disable IPv6 if
        required (IPv6 might caus issues with the Internet connection being slow)</h1>
    <p>net.ipv6.conf.all.disable_ipv6 = 1
        net.ipv6.conf.default.disable_ipv6 = 1
        net.ipv6.conf.lo.disable_ipv6 = 1</p>
    <h1 id="accept-redirects-no-this-is-not-router">Accept Redirects? No, this is not router</h1>
    <p>net.ipv4.conf.all.secure_redirects = 0</p>
    <h1 id="log-packets-with-impossible-addresses-to-kernel-log-yes">Log packets with impossible addresses to kernel
        log? yes</h1>
    <p>net.ipv4.conf.default.secure_redirects = 0</p>
    <h1 id="ipv6-number-of-router-solicitations-to-send-until-assuming-no-routers-are-present">[IPv6] Number of Router
        Solicitations to send until assuming no routers are present</h1>
    <h1 id="this-is-host-and-not-router">This is host and not router</h1>
    <p>net.ipv6.conf.default.router_solicitations = 0</p>
    <h1 id="accept-router-preference-in-ra">Accept Router Preference in RA?</h1>
    <p>net.ipv6.conf.default.accept_ra_rtr_pref = 0</p>
    <h1 id="learn-prefix-information-in-router-advertisement">Learn prefix information in router advertisement</h1>
    <p>net.ipv6.conf.default.accept_ra_pinfo = 0</p>
    <h1 id="setting-controls-whether-the-system-will-accept-hop-limit-settings-from-a-router-advertisement">Setting
        controls whether the system will accept Hop Limit settings from a router advertisement</h1>
    <p>net.ipv6.conf.default.accept_ra_defrtr = 0</p>
    <h1 id="router-advertisements-can-cause-the-system-to-assign-a-global-unicast-address-to-an-interface">Router
        advertisements can cause the system to assign a global unicast address to an interface</h1>
    <p>net.ipv6.conf.default.autoconf = 0</p>
    <h1 id="how-many-neighbor-solicitations-to-send-out-per-address">How many neighbor solicitations to send out per
        address?</h1>
    <p>net.ipv6.conf.default.dad_transmits = 0</p>
    <h1 id="how-many-global-unicast-ipv6-addresses-can-be-assigned-to-each-interface">How many global unicast IPv6
        addresses can be assigned to each interface?</h1>
    <p>net.ipv6.conf.default.max_addresses = 1</p>
    <h1 id="in-rare-occasions-it-may-be-beneficial-to-reboot-your-server-reboot-if-it-runs-out-of-memory">In rare
        occasions, it may be beneficial to reboot your server reboot if it runs out of memory</h1>
    <h1 id="this-simple-solution-can-avoid-you-hours-of-down-time-the-vmpanic_on_oom1-line-enables-panic">This simple
        solution can avoid you hours of down time. The vm.panic_on_oom=1 line enables panic</h1>
    <h1 id="on-oom-the-kernelpanic10-line-tells-the-kernel-to-reboot-ten-seconds-after-panicking">on OOM; the
        kernel.panic=10 line tells the kernel to reboot ten seconds after panicking</h1>
    <p> vm.panic_on_oom = 1
        kernel.panic = 10
        ```</p>
    <ul>
        <li>enable settings with `sudo sysctl -p`</li>
    </ul>
    <h3 id="verify-openssl-is-new-enough-to-prevent-heartbleed">Verify OpenSSL is new enough to prevent Heartbleed</h3>
    <p>`openssl version -v` needs to output 1.0.1f or higher, otherwise raw sysinfo can be hacked</p>
    <h3 id="securing-tmp-directories">Securing /tmp directories</h3>
    <ul>
        <li>This will prevent executables in /tmp and /var/tmp. Attackers make use of /tmp as it is usually 777 and can
            server as a staging area for scripts.</li>
    </ul>
    <p>```</p>
    <h1 id="lets-create-a-1gb-or-what-is-best-for-you-filesystem-file-for-the-tmp-parition">Let&#39;s create a 1GB (or
        what is best for you) filesystem file for the /tmp parition</h1>
    <p>sudo fallocate -l 1G /tmpdisk
        sudo mkfs.ext4 /tmpdisk
        sudo chmod 0600 /tmpdisk</p>
    <h1 id="mount-the-new-tmp-partition-and-set-the-right-permissions">Mount the new /tmp partition and set the right
        permissions</h1>
    <p>sudo mount -o loop,noexec,nosuid,rw /tmpdisk /tmp
        sudo chmod 1777 /tmp</p>
    <h1 id="set-the-tmp-in-the-fstab">Set the /tmp in the fstab</h1>
    <p>sudo nano /etc/fstab
        ADD THIS-&gt; /tmpdisk /tmp ext4 loop,nosuid,noexec,rw 0 0
        sudo mount -o remount /tmp</p>
    <h1 id="secure-vartmp-by-repeating-the-steps-above">Secure /var/tmp by repeating the steps above</h1>
    <p>```</p>
    <ul>
        <li>test by creating a `hello.sh` in /tmp that echoes something, run `chmod +x hello.sh &amp;&amp; ./hello.sh`
            to check perms</li>
    </ul>
    <h3 id="ip-spoofing-with-hosts">IP spoofing with hosts</h3>
    <p>Handled by google and others, no longer relevant from this tut</p>
    <h3 id="add-a-basic-antivirus-and-daily-scan">Add a basic antivirus and daily scan</h3>
    <ul>
        <li>clamscan should be available, you can test this with `sudo freshclam`. If you get an error it&#39;s running
        </li>
    </ul>
    <ul>
        <li>schedule a nightly cron to output found errors into logs<ul>
                <li>`sudo apt-get install clamav-daemon` //installs the daemon</li>
                <li>`sudo mkdir /home/ROOTUSER/clamscan &amp;&amp; chmod 700 /home/ROOTUSER/clamscan`//creates log dir
                </li>
                <li>sudo crontab -e<ul>
                        <li>`00 00 ** * clamscan -r /location_of_files_or_folder | grep FOUND &gt;&gt;
                            /home/ROOTUSER/clamscan/scanned-`date +%Y%m%d%H%M%S`.txt`</li>
                    </ul>
                </li>
                <li>ex ```clamscan -r /var/www/html | grep FOUND &gt;&gt; /home/clac/clamscan/scanned-`date
                    +%Y%m%d%H%M%S`.txt```</li>
                <li>add a crontab line for auto-removal of older logs (-10 days)<ul>
                        <li>`01 00 ** *find /home/ROOTUSER/clamscan/* -mtime +10 -exec rm {} ;`</li>
                    </ul>
                </li>
            </ul>
        </li>
    </ul>
    <h1 id="how-to-harden-your-ubuntu-1804-server">How to Harden your Ubuntu 18.04 Server</h1>
    <p><a
            href="https://medium.com/@BaneBiddix/how-to-harden-your-ubuntu-18-04-server-ffc4b6658fe7">https://medium.com/@BaneBiddix/how-to-harden-your-ubuntu-18-04-server-ffc4b6658fe7</a>
    </p>
    <ul>
        <li>Most of these are covered by the above.</li>
        <li>3 interesting notes came up for SSH hardening and fail2Ban.</li>
    </ul>
    <h3 id="ssh-hardening">SSH Hardening</h3>
    <ul>
        <li>Regenerate host keys (do this before setting up users for SSH)
            `rm /etc/ssh/ssh_host_* &amp;&amp; ssh-keygen -A`</li>
        <li>Change ciphers and algorithms to stronger versions. Add this to `/etc/ssh/sshd_config`
            ```
            KexAlgorithms <a
                href="mailto:&#x63;&#x75;&#114;&#118;&#101;&#x32;&#x35;&#x35;&#49;&#57;&#45;&#x73;&#x68;&#97;&#x32;&#x35;&#x36;&#64;&#x6c;&#105;&#x62;&#115;&#x73;&#104;&#46;&#111;&#114;&#103;">&#x63;&#x75;&#114;&#118;&#101;&#x32;&#x35;&#x35;&#49;&#57;&#45;&#x73;&#x68;&#97;&#x32;&#x35;&#x36;&#64;&#x6c;&#105;&#x62;&#115;&#x73;&#104;&#46;&#111;&#114;&#103;</a>
            Ciphers <a
                href="mailto:&#x63;&#104;&#97;&#99;&#x68;&#x61;&#x32;&#48;&#45;&#112;&#111;&#x6c;&#x79;&#49;&#x33;&#x30;&#53;&#x40;&#111;&#112;&#101;&#110;&#x73;&#115;&#104;&#x2e;&#x63;&#111;&#x6d;">&#x63;&#104;&#97;&#99;&#x68;&#x61;&#x32;&#48;&#45;&#112;&#111;&#x6c;&#x79;&#49;&#x33;&#x30;&#53;&#x40;&#111;&#112;&#101;&#110;&#x73;&#115;&#104;&#x2e;&#x63;&#111;&#x6d;</a>,<a
                href="mailto:&#97;&#101;&#x73;&#x32;&#53;&#x36;&#x2d;&#103;&#x63;&#x6d;&#64;&#111;&#112;&#101;&#110;&#115;&#115;&#104;&#x2e;&#99;&#x6f;&#x6d;">&#97;&#101;&#x73;&#x32;&#53;&#x36;&#x2d;&#103;&#x63;&#x6d;&#64;&#111;&#112;&#101;&#110;&#115;&#115;&#104;&#x2e;&#99;&#x6f;&#x6d;</a>,<a
                href="mailto:&#x61;&#101;&#115;&#x31;&#x32;&#56;&#45;&#103;&#99;&#109;&#x40;&#x6f;&#x70;&#x65;&#x6e;&#115;&#115;&#104;&#x2e;&#x63;&#x6f;&#x6d;">&#x61;&#101;&#115;&#x31;&#x32;&#56;&#45;&#103;&#99;&#109;&#x40;&#x6f;&#x70;&#x65;&#x6e;&#115;&#115;&#104;&#x2e;&#x63;&#x6f;&#x6d;</a>,aes256-ctr,aes192-ctr,aes128-ctr
            MACs hmac-sha2–<a
                href="mailto:&#53;&#x31;&#x32;&#45;&#x65;&#x74;&#x6d;&#64;&#x6f;&#112;&#101;&#x6e;&#115;&#x73;&#104;&#x2e;&#99;&#x6f;&#x6d;">&#53;&#x31;&#x32;&#45;&#x65;&#x74;&#x6d;&#64;&#x6f;&#112;&#101;&#x6e;&#115;&#x73;&#104;&#x2e;&#99;&#x6f;&#x6d;</a>,hmac-sha2–<a
                href="mailto:&#50;&#53;&#54;&#x2d;&#101;&#116;&#109;&#64;&#x6f;&#112;&#101;&#110;&#115;&#x73;&#x68;&#46;&#99;&#x6f;&#109;">&#50;&#53;&#54;&#x2d;&#101;&#116;&#109;&#64;&#x6f;&#112;&#101;&#110;&#115;&#x73;&#x68;&#46;&#99;&#x6f;&#109;</a>,<a
                href="mailto:&#x75;&#109;&#x61;&#x63;&#45;&#x31;&#x32;&#56;&#x2d;&#x65;&#116;&#x6d;&#64;&#x6f;&#112;&#101;&#x6e;&#115;&#115;&#104;&#46;&#99;&#111;&#x6d;">&#x75;&#109;&#x61;&#x63;&#45;&#x31;&#x32;&#56;&#x2d;&#x65;&#116;&#x6d;&#64;&#x6f;&#112;&#101;&#x6e;&#115;&#115;&#104;&#46;&#99;&#111;&#x6d;</a>
            ```</li>
    </ul>
    <h3 id="ssh-audit">ssh-audit</h3>
    <p>This is a script that outputs a ton of info on the ssh config of the server, and makes recommendations</p>
    <p><a href="https://github.com/jtesta/ssh-audit/">https://github.com/jtesta/ssh-audit/</a></p>
    <ul>
        <li>On a local dev box, clone the repo and audit via `python ssh-audit.py yoursite.com`</li>
    </ul>
    <h3 id="fail2ban">Fail2Ban</h3>
    <p>Fail2Ban bans IPs with malicious/suspicious login activity/server log activity. Great for preventing port
        sniffing/etc.</p>
    <p><a href="https://www.fail2ban.org/wiki/index.php/Main_Page">https://www.fail2ban.org/wiki/index.php/Main_Page</a>
    </p>
    <ul>
        <li>install using `sudo apt-get install fail2ban`</li>
        <li>check if running with `fail2ban-client status`</li>
        <li>check for REJECT lines (fail2Ban is working) using `sudo iptables -L f2b-sshd`</li>
    </ul>
    <h1 id="apache-hardening-guide">Apache Hardening Guide</h1>
    <ul>
        <li>
            <p>Remove indexing on folders</p>
            <ul>
                <li>In the server&#39;s `.conf` file, add this to both :80 and :443 blocks:
                    ```&lt;Directory /YOURDIR&gt;
                    //add this line:
                    Options All -Indexes
                    </Directory>```</li>
            </ul>
        </li>
        <li>
            <p>Prevent Etag (allows attackers to get info on process/MIME info)</p>
            <ul>
                <li>Add this to the server&#39;s .conf files: `FileETag None` above the `<Directory>`</li>
                <li>This also forces assets to be dependent on &#39;Expires&#39; or &#39;Cache-control&#39; headers over
                    server caching static assets</li>
            </ul>
        </li>
        <li>
            <p>Turn off TRACE requests</p>
            <ul>
                <li>`TraceEnable off` added above `<Directory>`</li>
            </ul>
        </li>
        <li>
            <p>Force HTTPS cookies and do not allow page to be served in an iframe with X-Frame-Options
                ```Header always append X-Frame-Options SAMEORIGIN
                Header edit Set-Cookie ^(.*)$ $1;HttpOnly;Secure```</p>
        </li>
        <li>
            <p>ModSecurity is a application firewall, it is available and configurable, but many of the techniques are
                covered by other settings above</p>
        </li>
    </ul>
</body>

</html>